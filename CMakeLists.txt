SET(PROJECT_NAME git-chat)
PROJECT(${PROJECT_NAME} C)

CMAKE_MINIMUM_REQUIRED(VERSION 2.8.11)

# version
SET(CMAKE_PROJECT_VERSION_MAJOR 0)
SET(CMAKE_PROJECT_VERSION_MINOR 1)

SET(CMAKE_C_STANDARD 99)

# compiler options
IF(CMAKE_COMPILER_IS_GNUCC)
	add_definitions(-Wall -Werror -pedantic -std=c99)
ENDIF(CMAKE_COMPILER_IS_GNUCC)

# Configure Project
CONFIGURE_FILE(
	"${PROJECT_SOURCE_DIR}/templates/version.h.in"
	"${PROJECT_BINARY_DIR}/include/version.h"
)

FILE(GLOB_RECURSE SRC_LIST FOLLOW_SYMLINKS src/*.c)
FILE(GLOB_RECURSE HEAD_FILES FOLLOW_SYMLINKS include/*.h ${PROJECT_BINARY_DIR}/include/*.h)
FILE(GLOB_RECURSE SHARE_LIST FOLLOW_SYMLINKS share/*)

INCLUDE_DIRECTORIES(
	"${PROJECT_SOURCE_DIR}/include/"
	"${PROJECT_SOURCE_DIR}/test/include/"
	"${PROJECT_BINARY_DIR}/include/"
)

ADD_EXECUTABLE(${PROJECT_NAME} ${PROJECT_SOURCE_DIR}/src/git-chat.c ${SRC_LIST})
INSTALL(TARGETS ${PROJECT_NAME} RUNTIME DESTINATION bin)
INSTALL(DIRECTORY ${PROJECT_SOURCE_DIR}/share/ DESTINATION share/${PROJECT_NAME})

FILE(
		COPY "${PROJECT_SOURCE_DIR}/test/resources/"
		DESTINATION "${PROJECT_BINARY_DIR}/resources/"
)
FILE(GLOB_RECURSE TEST_SRC_LIST FOLLOW_SYMLINKS ${PROJECT_SOURCE_DIR}/test/*.c ${PROJECT_SOURCE_DIR}/test/unit/*.c ${PROJECT_SOURCE_DIR}/src/*.c)
LIST(REMOVE_ITEM TEST_SRC_LIST ${PROJECT_SOURCE_DIR}/src/git-chat.c)
ADD_EXECUTABLE(${PROJECT_NAME}-test ${PROJECT_SOURCE_DIR}/test/runner.c ${PROJECT_SOURCE_DIR}/test/test-lib.c ${TEST_SRC_LIST})